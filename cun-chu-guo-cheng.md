# 存储过程

## 存储过程

#### 存储过程是预编译, 相当于定义了一个函数, 调用就会运行.

### 优点

* 存储过程增强了SQL语言的功能和灵活性
* 允许标准组件是编程的.
* 存储过程能实现较快的执行速度
* 存储过程能减少网络流量
* 存储过程可被是为一种安全机制来充分利用

### 创建存储过程

```sql
#1. 首先选中一个数据库, 注意: 创建的存储过程, 只能在选中的这个库内执行!!!!
        mysql> use  库;

#2. 改变分隔符功能  ;    不让其成为执行结束的标记. 主要是为了后面的步骤.
        # 执行完毕后,分号结尾就无用了,  必须使用  $$  来进行语句结尾.( 或者使用 $$; )
                mysql>  delimiter $$;
                mysql>  SHOW TABLES $$    #语句也就变成了这样.

#3. 创建存储过程,关键词是 procedure, 随后的参数是自定义的过程名字和括号内的参数,就当函数看.
        mysql> CREATE PROCEDURE  
                hello_p()        #  比如我自定义的名字是 hello_p,把这个看成函数名字
                begin              #从这里开始向下到 end  ,当成函数体看.
                SELECT 'hello';     # 上面改变了分隔符, 所以这里不会直接执行,而是继续向下读取
                SELECT 'world';     
                end  $$           # 两个$ 才是分隔符,  (没准还会加上 ;  分隔符)

#4. 存错过程创建完成后, 需要恢复分隔符的功能,然后才可以执行刚刚创建的存储过程.
        mysql> delimiter ;        #执行完毕之后可能没有返回值.这是正常的.(报错就是你关键字打错了)

#5. 执行存储过程. 说白了就是一个函数调用.
        mysql> call hello_p;      # 调用函数名, 如果我括号内有参数,那么需要用括号带上参数.
        mysql> call hello_p(参数1,参数2);   #调用有参数的 存储过程
 

  # 根据上面的存储过程定义, 调用后会打印如下结果,(完全就是将两个语句进行封装嘛,跟函数封装没区别).
 
mysql> call p_hello;
+-------+
| hello |
+-------+
| hello |
+-------+
1 row in set (0.01 sec)

+-------+
| world |
+-------+
| world |
+-------+
1 row in set (0.01 sec)

Query OK, 0 rows affected (0.01 sec)
 
```

### 恢复分隔符功能

```sql
mysql> delimiter ;       
```

### 执行存储过程

```sql
# 执行之前 ,需要恢复分隔符功能. 否则会失败
mysql> call  hello_p ;                  #无参数, 存储过程名是 hello_p
mysql> call  hello_p(参数1,参数2);       #有参数的调用
```

### 删除存储过程

```sql
MySQL中使用DROP PROCEDURE语句来删除存储过程.
mysql>   DROP PROCEDURE  p_hello;     #后面是存储过程名
```

